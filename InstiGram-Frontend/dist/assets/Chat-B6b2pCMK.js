import{r as a,e as u,j as e,B as d,u as j}from"./index-D9AcpMqu.js";import{S as v}from"./SideNav-mCBdQBu_.js";import{C as N}from"./ChatContacts-DS-ufPdk.js";function y(){const[h,c]=a.useState([]),{id:t}=u(),n=localStorage.getItem("userId");let[i,m]=a.useState({message:""});const[o,x]=a.useState();a.useEffect(()=>{const r=setInterval(async()=>{try{const p=await(await fetch(d+"/getmessages/"+n+"/"+t+"/",{method:"GET",credentials:"include"})).json();Array.isArray(p)?c(p):console.log("messages nhi aa rhe")}catch(l){console.log("Errorrrrrrrrrrrr",l)}},1e3);return()=>clearInterval(r)},[]),a.useEffect(()=>{(async()=>{try{const l=await(await fetch(d+"/search/"+t+"/",{method:"GET",credentials:"include"})).json();x(l)}catch(r){console.log("Errorrrrrrrrrrrr",r)}})()},[]);const g=s=>{m({...i,message:s.target.value})},f=()=>{const s=new FormData;s.append("user",n),s.append("sender",n),s.append("reciever",t),s.append("msg",i.message),s.append("is_read",!1);try{fetch(d+"/sendmessages/",{method:"POST",body:s}).then(r=>{if(!r.ok)throw new Error("Network response was not ok");return r.json()}).then(r=>{document.getElementById("chat-box").value="",m(i="")}).catch(r=>{console.error("error in fetch operation:",r)})}catch(r){console.error("Error outside of fetch operation:",r)}};return e.jsxs("div",{className:"parent-chat-div col-12 col-lg-7 col-xl-9 chatbox",children:[e.jsx("div",{className:"py-2 px-4 border-bottom d-none d-lg-block",children:e.jsxs("div",{className:"d-flex align-items-center py-1",children:[e.jsx("div",{className:"position-relative",children:o&&e.jsx("img",{src:o[0].profileimg,className:"rounded-circle mr-1",alt:"pfp",width:40,height:40})}),e.jsxs("div",{className:"flex-grow-1 pl-3",children:[o&&e.jsx("strong",{children:o[0].user}),e.jsx("div",{className:"  small"})]}),e.jsx("div",{})]})}),e.jsx("div",{className:"position-relative  ",children:e.jsx("div",{className:"chat-messages p-4",children:h.map((s,r)=>e.jsxs("div",{children:[s.sender_profile.id_user==n&&e.jsxs("div",{className:"chat-message-right pb-4",children:[e.jsx("div",{children:e.jsx("img",{src:s.sender_profile.profileimg,className:"rounded-circle mr-1",alt:"pfp",width:40,height:40})}),e.jsxs("div",{className:"flex-shrink-1 bg-light rounded py-2 px-3 mr-3",children:[e.jsx("div",{className:"font-weight-bold mb-1",children:"You"}),s.msg]})]}),s.sender!=n&&e.jsxs("div",{className:"chat-message-left pb-4",children:[e.jsx("div",{children:e.jsx("img",{src:s.sender_profile.profileimg,className:"rounded-circle mr-1",alt:"pfp",width:40,height:40})}),e.jsxs("div",{className:"flex-shrink-1 bg-light rounded py-2 px-3 ml-3",children:[e.jsx("div",{className:"font-weight-bold mb-1",children:s.sender_profile.user}),s.msg]})]})]},r))})}),e.jsx("div",{className:"flex-grow-0 py-3 px-4 border-top",children:e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Type your message here",id:"chat-box",value:i.message,onChange:g}),e.jsx("button",{className:"btn btn-primary",onClick:f,children:"Send"})]})})]})}function S(){const h=j();return a.useEffect(()=>{fetch(`${d}/cookie`,{method:"POST",credentials:"include",headers:{"Content-type":"application/json"}}).then(async function(c){const t=c.status;await c.json(),t==401&&h("/signin")})},[]),e.jsxs("div",{className:"chat-container",children:[e.jsx(v,{}),e.jsx("div",{className:"container-main-chat",children:e.jsx("main",{className:"content",style:{marginTop:"0px"},children:e.jsxs("div",{className:"container-extra",children:[e.jsx("span",{children:e.jsx("h1",{className:"heading-chat",children:"Messages"})}),e.jsxs("div",{className:"card1 row",children:[e.jsx(N,{}),e.jsx(y,{})]})]})})})]})}export{S as default};
