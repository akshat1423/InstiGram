import{a as S,r as l,c as C,u as k,j as e,L as I,B as j,b as O}from"./index-D9AcpMqu.js";import{f as w,S as L}from"./SideNav-mCBdQBu_.js";function P({onSubmit:s,comments:r}){const[a,t]=l.useState("");l.useState(!1);const d=n=>{t(n.target.value)},o=async n=>{if(n.preventDefault(),a.trim()!=="")try{await s(a),t("")}catch(h){console.error("Error submitting comment:",h)}};return e.jsxs("div",{className:"c",children:[e.jsxs("div",{className:"comm",children:[e.jsx("div",{className:"comm-head",children:"Comments"}),e.jsx("ul",{className:"all-comments",children:r.map(n=>e.jsxs("li",{children:[e.jsxs("span",{className:"cauth",children:[n.commentAuth,":"]})," ",n.commentContent]},n.commentId))})]}),e.jsxs("form",{onSubmit:o,className:"comment_box",children:[e.jsx("input",{type:"text",placeholder:"Enter your Comment",value:a,onChange:d,required:!0,className:"comment_field"}),e.jsx("button",{type:"submit",className:"send-btn"})]})]})}function $(s){const[r,a]=S(w),[t,d]=l.useState(s.isLiked),[o,n]=l.useState(!1),h=C(),x=k(),g=async()=>{try{const c=localStorage.getItem("userId"),m=s.id,f={userId:c,liked:!t,postId:m},p=await fetch(`${j}/liked`,{method:"POST",credentials:"include",headers:{"Content-type":"application/json"},body:JSON.stringify(f)}),v=await p.json();p.status==200&&(d(!t),fetch(`${j}/feed`,{method:"POST",credentials:"include",headers:{"Content-type":"application/json"},body:JSON.stringify(f)}).then(async function(u){const b=await u.json();u.status==200?a(b):u.status==401&&x("/signin")}))}catch(c){console.error("Error liking:",c)}},N=()=>{n(!o)},i=async c=>{try{const m=localStorage.getItem("userId"),f=s.id,v={commentAuth:m,postId:f,commentContent:c},u=await fetch(`${j}/comment`,{method:"POST",credentials:"include",headers:{"Content-type":"application/json"},body:JSON.stringify(v)}),b=await u.json();if(u.status==200){const _={userId:m};fetch(`${j}/feed`,{method:"POST",credentials:"include",headers:{"Content-type":"application/json"},body:JSON.stringify(_)}).then(async function(y){const E=await y.json();y.status==200?a(E):y.status==401&&x("/signin")})}else u.status==401&&x("/signin")}catch(m){console.error("Error submitting comment:",m)}finally{}};return e.jsxs("div",{className:"post",children:[e.jsxs("div",{className:"post_det",children:[e.jsx("div",{className:"post-profile-image-div",children:e.jsx("img",{src:s.profileImage,alt:"",className:"post-profile-image"})}),e.jsx(I,{to:`/profile/${s.authId}`,state:{background:h},className:"post_auth",children:s.auth})]}),e.jsxs("div",{className:"post_content",children:[e.jsx("img",{src:s.image,className:"post-image"}),e.jsx("div",{className:"post-caption",children:s.caption})]}),e.jsxs("div",{className:"bar",children:[s.isLiked?e.jsx("div",{className:"liked",onClick:g}):e.jsx("div",{className:"notLiked",onClick:g,children:" "}),e.jsx("div",{className:"comment_but",onClick:N}),e.jsx("div",{className:"share_but"})]}),e.jsxs("div",{className:"below_post",children:[e.jsxs("div",{className:"like_count",children:[s.likes," likes"]}),e.jsxs("div",{className:"comment_count",children:[s.comments.length," comments"]})]}),o&&e.jsx(P,{onSubmit:i,comments:s.comments})]})}function B(s){const r=C();return e.jsx("div",{className:"below-search",children:e.jsx("ul",{className:"search-res",children:s.result.map(a=>e.jsx(I,{to:`/profile/${a.userId}`,state:{background:r},children:e.jsx("li",{className:"res",children:a.data},a.userId)}))})})}const R=O({key:"searchAtom",default:[{userId:1,userName:"fwww",gradYear:2027,department:"CSE"},{userId:4,userName:"getg",gradYear:2021,department:"ME"},{userId:2,userName:"getg",gradYear:2021,department:"ME"}]}),T=()=>{const[s,r]=l.useState(""),[a,t]=S(R),[d,o]=l.useState(!1),n=l.useRef(null);let h;async function x(i){try{const c={query:i},f=await(await fetch(`${j}/search`,{method:"POST",credentials:"include",headers:{"Content-type":"application/json"},body:JSON.stringify(c)})).json();t(f),console.log({searchResult:a})}catch(c){console.error(c)}}function g(i){const c=i.target.value;r(c),clearTimeout(h),h=setTimeout(()=>{c!=""?x(c):t([])},300)}function N(i){i.preventDefault(),o(!0)}return l.useEffect(()=>{function i(c){n.current&&!n.current.contains(c.target)&&o(!1)}return document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}},[]),e.jsxs("div",{ref:n,children:[e.jsxs("form",{id:"search_bar",name:"search_bar",onSubmit:N,children:[e.jsx("input",{type:"text",id:"search",name:"search",autoFocus:!1,autoComplete:"off",value:s,onChange:g,onClick:()=>o(!0)}),e.jsx("button",{type:"submit",className:"search_icon"})]}),d&&e.jsx(B,{result:a})]})},A=T;function D(){const s=k(),[r,a]=S(w);return l.useEffect(()=>{const d={userId:localStorage.getItem("userId")};fetch(`${j}/feed`,{method:"POST",credentials:"include",headers:{"Content-type":"application/json"},body:JSON.stringify(d)}).then(async function(o){const n=await o.json();o.status==200?a(n):o.status==401&&s("/signin")})},[]),e.jsxs("div",{children:[e.jsx(L,{className:"fixed"}),e.jsxs("div",{className:"scrollable-container-feed",children:[e.jsx("div",{className:"header",children:e.jsx(A,{className:"fixed"})}),e.jsx("div",{className:"posts",children:r.map(t=>e.jsx($,{id:t._id,auth:t.auth,authId:t.authId,profileImage:t.profileImage,image:t.postImage,likes:t.likes,comments:t.comments,isLiked:t.isLiked,caption:t.caption,className:"post"},r.indexOf(t)))})]})]})}export{D as default};
