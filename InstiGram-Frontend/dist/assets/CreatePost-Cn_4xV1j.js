import{b,R as C,d as S,a as p,u as y,j as e,f as x,r as g,B as f}from"./index-D9AcpMqu.js";import{a as A,f as R,S as _}from"./SideNav-mCBdQBu_.js";import{P as k,m as j}from"./PopupCard-D7E3FFse.js";import{p as F}from"./postAtom-DEgVzU20.js";/* empty css                  */const N=b({key:"createPostAtom",default:null});function w({handleSubmit:i}){const n=C(S),[s,o]=p(N),l=y();function d(t){if(t.target.files&&t.target.files[0]){let c=new FileReader;c.onload=a=>{o(a.target.result),console.log(a.target.result)},c.readAsDataURL(t.target.files[0])}}return e.jsx(e.Fragment,{children:e.jsxs(k,{children:[e.jsx("div",{className:"create-title",children:"Create Post"}),e.jsx("div",{className:"create-close-button-div",onClick:()=>{l(-1),o(null)}}),e.jsxs("form",{className:"create-post-form",onSubmit:t=>i(t),children:[e.jsxs("label",{htmlFor:"create-image",className:"create-image-label",children:[e.jsxs("div",{className:"create-image-label-container "+(s?"hide":""),children:[e.jsx("div",{className:"create-image-label-icon"}),e.jsx("div",{className:"create-image-label-text",children:"Add Photo"})]}),e.jsx("img",{src:s,className:"selected-create-image"+(s?" ":"hide")})]}),e.jsx("input",{type:"file",id:"create-image",name:"image",accept:"image/*",onChange:d,className:"image-input "}),e.jsxs("div",{className:"create-form-inputs",children:[e.jsx("label",{htmlFor:"caption",className:"caption-label",children:"Caption: "}),e.jsx("textarea",{name:"caption",id:"caption",cols:"30",rows:"10",className:"dark"})]}),e.jsx("div",{className:"submit-div",children:e.jsx("button",{type:"submit",className:"create-submit "+(n?"dark":""),children:"Post"})})]})]})})}const E={initial:{y:"100vh",opacity:0},animate:{opacity:1,y:0},exit:{y:"100vh"}},I={initial:{opacity:0},animate:{opacity:1,delay:.5},exit:{opacity:0}};function J(){const i=x(A),[n,s]=p(N),o=x(R),[l,d]=p(F),t=y();g.useEffect(()=>{fetch(`${f}/cookie`,{method:"POST",credentials:"include",headers:{"Content-type":"application/json"}}).then(async function(a){const m=a.status;await a.json(),m==401&&t("/signin")})},[]);function c(a){a.preventDefault();const m=new FormData(a.target),r={userId:localStorage.getItem("userId"),postImage:n,caption:m.get("caption"),likes:0,comments:0};n!=null&&fetch(`${f}/post/create`,{method:"POST",credentials:"include",headers:{"Content-type":"application/json"},body:JSON.stringify(r)}).then(async function(h){const v=await h.json();console.log(r),console.log(v),h.status==200&&(d([...l,r]),t("/feed"),fetch(`${f}/feed`,{method:"POST",credentials:"include",headers:{"Content-type":"application/json"},body:JSON.stringify(r)}).then(async function(u){const P=await u.json();u.status==200?o(P):u.status==401&&t("/signin")}))})}return g.useEffect(()=>(i(!0),s(null),()=>{i(!1)}),[]),e.jsx(e.Fragment,{children:e.jsxs(j.div,{className:"create-overlay",variants:I,initial:"initial",animate:"animate",exit:"exit",children:[e.jsx(_,{className:"create-sidebar"}),e.jsx(j.div,{className:"create-animate-container",variants:E,children:e.jsx("div",{className:"scrollable-container",children:e.jsx(w,{handleSubmit:c})})})]})})}export{J as default};
