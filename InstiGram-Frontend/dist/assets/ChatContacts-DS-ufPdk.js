import{c as _,j as e,L as f,b as y,r as i,a as g,B as h}from"./index-D9AcpMqu.js";function v(s){const l=_();return e.jsx("div",{className:"below-search-chat",children:e.jsx("ul",{className:"search-res-chat",children:s.result.map(n=>e.jsx(f,{to:`/chat/${n.userId}`,state:{background:l},children:e.jsxs("li",{className:"res-chat",children:[n.data,"  "]},n.userId)}))})})}const C=y({key:"searchChatAtom",default:[{userId:1,userName:"fwsaw",gradYear:2027,department:"CSE"},{userId:4,userName:"vaibhav",gradYear:2021,department:"ME"},{userId:2,userName:"singh",gradYear:2021,department:"ME"}]}),N=()=>{const[s,l]=i.useState(""),[n,d]=g(C),[r,t]=i.useState(!1),a=i.useRef(null);let u;async function m(o){try{const c={query:o},j=await(await fetch(`${h}/search`,{method:"POST",credentials:"include",headers:{"Content-type":"application/json"},body:JSON.stringify(c)})).json();d(j)}catch(c){console.error(c)}}function p(o){const c=o.target.value;l(c),clearTimeout(u),u=setTimeout(()=>{c!=""?m(c):d([])},300)}function x(o){o.preventDefault(),t(!0)}return i.useEffect(()=>{function o(c){a.current&&!a.current.contains(c.target)&&t(!1)}return document.addEventListener("mousedown",o),()=>{document.removeEventListener("mousedown",o)}},[]),e.jsxs("div",{ref:a,children:[e.jsxs("form",{id:"search_bar_chat",name:"search_bar_chat",onSubmit:x,children:[e.jsx("input",{type:"text",id:"search-chat",name:"search-chat",autoFocus:!1,autoComplete:"off",value:s,onChange:p,onClick:()=>t(!0)}),e.jsx("button",{type:"submit",className:"search_icon"})]}),r&&e.jsx(v,{result:n})]})};function S(){const s=localStorage.getItem("userId"),[l,n]=i.useState([]);i.useEffect(()=>{(async()=>{try{const a=await(await fetch(h+"/messages/"+s+"/",{method:"GET",credentials:"include"})).json();Array.isArray(a)?n(a):console.error("API response is not an array:",error)}catch(t){console.error(t)}})()},[]);function d(){i.useEffect(()=>{(async()=>{try{const a=await(await fetch(h+"/messages/"+s+"/",{method:"GET",credentials:"include"})).json();Array.isArray(a)?n(a):console.error("API response is not an array:",error)}catch(t){console.error(t)}})()},[])}return e.jsxs("div",{className:"col-12 col-lg-5 col-xl-3 border-right div1-chat",children:[e.jsx("div",{className:"px-4 d-none d-md-block",children:e.jsx("div",{className:"d-flex align-items-center",children:e.jsx("div",{className:"flex-grow-1 search-bar-chat ",children:e.jsx(N,{})})})}),l.map(r=>e.jsx(f,{onClick:d,to:"/chat/"+(r.sender==s?r.reciever_profile.id_user:r.sender_profile.id_user),className:"list-group-item list-group-item-action border-0",children:e.jsxs("div",{className:"d-flex align-items-start chat-person",children:[e.jsx("img",{src:r.sender_profile.id_user!=s?r.sender_profile.profileimg:r.reciever_profile.profileimg,className:"rounded-circle mr-1 chat-pfp",width:40,height:40}),e.jsxs("div",{className:"flex-grow-1 ml-3",children:[r.sender_profile.id_user!=s?r.sender_profile.user:r.reciever_profile.user,e.jsx("div",{className:"small",children:r.msg})]})]})},r.id)),e.jsx("hr",{className:"d-block d-lg-none mt-1 mb-0"})]})}export{S as C};
